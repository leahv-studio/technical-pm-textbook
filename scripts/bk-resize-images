#!/bin/bash
#
# Image Compression Script Wrapper for Modeling Healthcare Data
# Compresses large images to approximately 300KB in PNG format for web optimization
#
# This script wraps the Python image compression utility and runs it from anywhere in the repo

# Get the directory where this script is located
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

# Navigate to the repository root (parent of scripts/)
REPO_ROOT="$( cd "$SCRIPT_DIR/.." && pwd )"

# Path to the Python compression script
PYTHON_SCRIPT="$REPO_ROOT/src/resize-images/compress-images.py"

# Check if Python script exists
if [ ! -f "$PYTHON_SCRIPT" ]; then
    echo "Error: Python script not found at $PYTHON_SCRIPT"
    exit 1
fi

# Check if Python 3 is available
if ! command -v python3 &> /dev/null; then
    echo "Error: python3 is not installed or not in PATH"
    exit 1
fi

# Check if PIL/Pillow is installed
if ! python3 -c "import PIL" &> /dev/null; then
    echo "Error: Pillow (PIL) is not installed"
    echo "Install it with: pip3 install Pillow"
    exit 1
fi

# Run the Python script
echo "Running image compression script..."
echo "Repository root: $REPO_ROOT"
echo ""

cd "$REPO_ROOT" || exit 1
python3 "$PYTHON_SCRIPT" "$@"

exit $?
