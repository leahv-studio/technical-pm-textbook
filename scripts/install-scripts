#!/bin/bash
# install-scripts
#
# Creates symbolic links for all shell scripts in the scripts directory
# and places them in $HOME/.local/bin for easy command-line access

set -e  # Exit on error

# Colors for output
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Get the directory where this script is located
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
TARGET_DIR="$HOME/.local/bin"

echo -e "${BLUE}Installing script symlinks...${NC}"

# Create target directory if it doesn't exist
if [ ! -d "$TARGET_DIR" ]; then
    echo -e "${GREEN}Creating directory: $TARGET_DIR${NC}"
    mkdir -p "$TARGET_DIR"
fi

# Counter for installed scripts
installed_count=0

# Find all executable shell scripts and other executable files
for script in "$SCRIPT_DIR"/*; do
    # Skip if no files match the pattern
    [ -e "$script" ] || continue

    # Get the base name
    basename=$(basename "$script")

    # Skip README files and non-executable files
    if [[ "$basename" == "README.md" ]] || [[ "$basename" == "README" ]]; then
        continue
    fi

    # Skip if not executable (unless it's a .sh file we want to make available)
    if [ ! -x "$script" ] && [[ "$basename" != *.sh ]]; then
        continue
    fi

    # Create link name (remove .sh extension if present)
    link_name="${basename%.sh}"
    link_path="$TARGET_DIR/$link_name"

    # Remove existing file or symlink if it exists
    if [ -e "$link_path" ] || [ -L "$link_path" ]; then
        rm -f "$link_path"
    fi

    # Create symlink
    ln -s "$script" "$link_path"
    echo -e "${GREEN}✓${NC} Created symlink: $link_name -> $script"
    ((installed_count++))
done

echo ""
echo -e "${GREEN}Successfully installed $installed_count script(s) to $TARGET_DIR${NC}"
echo ""

# Check if $HOME/.local/bin is in PATH
if [[ ":$PATH:" == *":$TARGET_DIR:"* ]]; then
    echo -e "${GREEN}✓${NC} $TARGET_DIR is already in your PATH"
else
    echo -e "${YELLOW}⚠${NC}  $TARGET_DIR is NOT in your PATH"
    echo ""
    echo "To use these scripts, add the following line to your shell startup file:"
    echo ""

    # Detect shell and provide appropriate instructions
    CURRENT_SHELL=$(basename "$SHELL")

    case "$CURRENT_SHELL" in
        bash)
            echo -e "${BLUE}# For Bash (add to ~/.bashrc or ~/.bash_profile):${NC}"
            echo 'export PATH="$HOME/.local/bin:$PATH"'
            ;;
        zsh)
            echo -e "${BLUE}# For Zsh (add to ~/.zshrc):${NC}"
            echo 'export PATH="$HOME/.local/bin:$PATH"'
            ;;
        fish)
            echo -e "${BLUE}# For Fish (add to ~/.config/fish/config.fish):${NC}"
            echo 'set -gx PATH $HOME/.local/bin $PATH'
            ;;
        *)
            echo -e "${BLUE}# Add to your shell startup file:${NC}"
            echo 'export PATH="$HOME/.local/bin:$PATH"'
            ;;
    esac

    echo ""
    echo "After adding the line, run:"
    echo "  source ~/.${CURRENT_SHELL}rc    # Or restart your terminal"
fi

echo ""
echo -e "${BLUE}Installed scripts:${NC}"
ls -1 "$TARGET_DIR" | grep -v "^$" || echo "None"
